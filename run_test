queue=$1
file=$2

time=$(driver/driver_$queue trace_files/$file)

driver/trace_stats trace_files/$file > test.out
ins=$(cat test.out | grep 'insert:' | grep -o '[0-9]*')
dmn=$(cat test.out | grep 'delete_min:' | grep -o '[0-9]*')
dcr=$(cat test.out | grep 'decrease_key:' | grep -o '[0-9]*')


valgrind --tool=cachegrind --branch-sim=yes driver/driver_$queue trace_files/$file > test.out 2>&1
inst=$(cat test.out | grep 'I   ref' | grep -o ' [0-9,]*' | sed 's/,//g' | grep -o '[0-9]*')
data_rd=$(cat test.out | grep 'D   ref' | grep -o '[0-9,]* rd' | sed 's/,//g' | grep -o '[0-9]*')
data_wr=$(cat test.out | grep 'D   ref' | grep -o '[0-9,]* wr' | sed 's/,//g' | grep -o '[0-9]*')
branch=$(cat test.out | grep 'Branches' | grep -o '[0-9,]* cond' | sed 's/,//g' | grep -o '[0-9]*')
rm test.out cachegrind.out*

echo $queue,$file,$ins,$dmn,$dcr,$time,$inst,$data_rd,$data_wr,$branch
